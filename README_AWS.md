# üöÄ Wuten Inmobiliaria - Gu√≠a Completa de Despliegue AWS

## üìã Descripci√≥n del Proyecto

**Wuten Inmobiliaria** es una aplicaci√≥n web React para gesti√≥n inmobiliaria con backend PHP, dise√±ada para funcionar en instancias AWS Linux con IP din√°mica.

## üèóÔ∏è Arquitectura

- **Frontend:** React + Vite
- **Backend:** PHP (Apache)
- **Servidor:** AWS Linux 2 / Amazon Linux 2023
- **Base de Datos:** MySQL/MariaDB
- **Gesti√≥n DB:** phpMyAdmin
- **Configuraci√≥n:** Sistema centralizado de IP din√°mica

## üöÄ PASO A PASO COMPLETO DE DESPLIEGUE

### üìã Prerrequisitos

- ‚úÖ Instancia AWS Linux 2 o Amazon Linux 2023
- ‚úÖ Acceso SSH a la instancia
- ‚úÖ Git configurado
- ‚úÖ Permisos de sudo
- ‚úÖ Base de datos funcional "wuten" (para migrar)

### üöÄ Instalaci√≥n Autom√°tica (Despu√©s del LAMP Stack)

```bash
# 1. Conectar a tu instancia AWS
ssh -i tu-key.pem ec2-user@TU_IP_AWS

# 2. Limpiar instalaci√≥n anterior (si existe)
wget https://raw.githubusercontent.com/tu-usuario/react-wuten/main/cleanup-aws.sh
chmod +x cleanup-aws.sh
./cleanup-aws.sh

# 3. Configurar Base de Datos (despu√©s del LAMP stack)
wget https://raw.githubusercontent.com/tu-usuario/react-wuten/main/setup-database.sh
chmod +x setup-database.sh
./setup-database.sh

# 4. Instalaci√≥n de la aplicaci√≥n
wget https://raw.githubusercontent.com/tu-usuario/react-wuten/main/install-wuten-aws.sh
chmod +x install-wuten-aws.sh

# Editar la URL del repositorio si es necesario
nano install-wuten-aws.sh
# Cambiar: REPO_URL="https://github.com/tu-usuario/react-wuten.git"

# Ejecutar instalaci√≥n
./install-wuten-aws.sh
```

---

## üîß PASO 1: PREPARACI√ìN DE LA INSTANCIA AWS

### 1.1 Crear Instancia AWS
```bash
# Configuraci√≥n recomendada:
# - Tipo: t3.micro (gratis) o t3.small (recomendado)
# - Sistema: Amazon Linux 2023
# - Almacenamiento: 20GB m√≠nimo
# - Grupos de seguridad: 
#   * SSH (puerto 22) - para conexi√≥n remota
#   * HTTP (puerto 80) - para acceso web
#   * HTTPS (puerto 443) - para SSL (opcional)
#   * MySQL/Aurora (puerto 3306) - para acceso remoto a BD (opcional)

# Referencia: https://docs.aws.amazon.com/es_es/linux/al2023/ug/ec2-lamp-amazon-linux-2023.html
```

### 1.2 Conectar a la Instancia
```bash
# Conectar via SSH
ssh -i tu-key.pem ec2-user@TU_IP_AWS

# Actualizar sistema
sudo dnf upgrade -y
```

### 1.3 Configurar IP El√°stica (Recomendado)
```bash
# En la consola AWS:
# 1. Ir a EC2 > Elastic IPs
# 2. Allocate Elastic IP
# 3. Associate con tu instancia
# 4. Anotar la IP el√°stica
```

---

## üóÑÔ∏è PASO 2: INSTALACI√ìN MANUAL DE LAMP STACK

**‚ö†Ô∏è IMPORTANTE:** Este paso debe realizarse MANUALMENTE siguiendo la [documentaci√≥n oficial de AWS](https://docs.aws.amazon.com/es_es/linux/al2023/ug/ec2-lamp-amazon-linux-2023.html) antes de continuar con la instalaci√≥n de la aplicaci√≥n.

### 2.1 Actualizar Sistema
```bash
# Actualizar todos los paquetes de software
sudo dnf upgrade -y
```

### 2.2 Instalar Apache y PHP
```bash
# Instalar Apache y PHP (versi√≥n 8.1 en AL2023)
sudo dnf install -y httpd wget php-fpm php-mysqli php-json php php-devel

# Iniciar y habilitar Apache
sudo systemctl start httpd
sudo systemctl enable httpd

# Verificar estado
sudo systemctl status httpd
sudo systemctl is-enabled httpd
```

### 2.3 Instalar MariaDB
```bash
# Instalar MariaDB 10.5 (versi√≥n disponible en AL2023)
sudo dnf install mariadb105-server

# Verificar versi√≥n instalada
sudo dnf info mariadb105

# Iniciar y habilitar MariaDB
sudo systemctl start mariadb
sudo systemctl enable mariadb

# Verificar estado
sudo systemctl status mariadb
```

### 2.4 Configurar MariaDB
```bash
# Ejecutar configuraci√≥n de seguridad
sudo mysql_secure_installation

# Respuestas recomendadas:
# - Enter current password for root: [Enter] (vac√≠o)
# - Set root password? [Y/n]: Y
# - New password: [Tu contrase√±a segura]
# - Remove anonymous users? [Y/n]: Y
# - Disallow root login remotely? [Y/n]: Y
# - Remove test database? [Y/n]: Y
# - Reload privilege tables? [Y/n]: Y
```

### 2.5 Instalar phpMyAdmin
```bash
# Instalar dependencias requeridas
sudo dnf install php-mbstring php-xml -y

# Reiniciar servicios
sudo systemctl restart httpd
sudo systemctl restart php-fpm

# Navegar al directorio de documentos de Apache
cd /var/www/html

# Descargar phpMyAdmin m√°s reciente
wget https://www.phpmyadmin.net/downloads/phpMyAdmin-latest-all-languages.tar.gz

# Crear directorio y extraer
mkdir phpMyAdmin && tar -xvzf phpMyAdmin-latest-all-languages.tar.gz -C phpMyAdmin --strip-components 1

# Limpiar archivo descargado
rm phpMyAdmin-latest-all-languages.tar.gz

# Configurar acceso (opcional - para desarrollo)
sudo nano /etc/httpd/conf.d/phpMyAdmin.conf
# Comentar las l√≠neas de restricci√≥n IP si es necesario
```

---

## üóÉÔ∏è PASO 3: CONFIGURACI√ìN DE BASE DE DATOS

**üí° OPCI√ìN A:** Configuraci√≥n Manual (recomendada para producci√≥n)
**üí° OPCI√ìN B:** Script Autom√°tico (para desarrollo/pruebas)

### 3.1 Crear Base de Datos y Usuario (Manual)
```bash
# Conectar a MariaDB
sudo mysql -u root -p

# Crear base de datos
CREATE DATABASE wuten CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;

# Crear usuario
CREATE USER 'wuten_user'@'localhost' IDENTIFIED BY 'TuPasswordSegura123!';

# Asignar permisos
GRANT ALL PRIVILEGES ON wuten.* TO 'wuten_user'@'localhost';
FLUSH PRIVILEGES;

# Verificar
SHOW DATABASES;
SELECT User, Host FROM mysql.user;

# Salir
EXIT;
```

### 3.2 Migrar Base de Datos Existente
```bash
# En tu servidor actual (WAMP/XAMPP):
mysqldump -u root -p wuten > wuten_backup.sql

# Transferir archivo a AWS (desde tu PC):
scp -i tu-key.pem wuten_backup.sql ec2-user@TU_IP_AWS:~/

# En AWS, importar la base de datos:
mysql -u wuten_user -p wuten < wuten_backup.sql

# Verificar importaci√≥n
mysql -u wuten_user -p wuten -e "SHOW TABLES;"
```

### 3.3 Verificar phpMyAdmin
```bash
# Acceder a phpMyAdmin
# URL: http://TU_IP_ELASTICA/phpMyAdmin
# Usuario: root (para configuraci√≥n inicial)
# Contrase√±a: [La contrase√±a que configuraste en mysql_secure_installation]

# Verificar que la base de datos "wuten" est√© presente
# Verificar que las tablas est√©n importadas correctamente

# Nota: Para producci√≥n, se recomienda crear un usuario espec√≠fico para la aplicaci√≥n
```

### 3.4 Configuraci√≥n Autom√°tica (Alternativa)

Si prefieres usar el script autom√°tico para configurar la base de datos:

```bash
# Descargar y ejecutar script de configuraci√≥n
wget https://raw.githubusercontent.com/tu-usuario/react-wuten/main/setup-database.sh
chmod +x setup-database.sh
./setup-database.sh
```

**‚ö†Ô∏è NOTA:** El script autom√°tico solicitar√° las contrase√±as de forma interactiva.

---

## üöÄ PASO 4: INSTALACI√ìN DE LA APLICACI√ìN

**‚úÖ PREREQUISITO:** Aseg√∫rate de haber completado los pasos 1, 2 y 3 (LAMP stack y base de datos configurados).

### 4.1 Instalar Node.js
```bash
# Instalar Node.js 18.x
curl -fsSL https://rpm.nodesource.com/setup_18.x | sudo bash -
sudo dnf install -y nodejs

# Verificar instalaci√≥n
node --version
npm --version
```

### 4.2 Clonar y Configurar Proyecto
```bash
# Crear directorio de la aplicaci√≥n
sudo mkdir -p /var/www/html/wuten
sudo chown ec2-user:ec2-user /var/www/html/wuten

# Clonar repositorio
cd /var/www/html/wuten
git clone https://github.com/tu-usuario/react-wuten.git .

# Instalar dependencias
npm install

# Verificar instalaci√≥n
npm run check-env
```

### 4.3 Configurar Variables de Entorno
```bash
# Crear archivo de configuraci√≥n de producci√≥n
cp env.production.example .env.production

# Editar configuraci√≥n
nano .env.production

# Configurar con tu IP el√°stica:
VITE_API_URL=http://TU_IP_ELASTICA/wuten/backend
VITE_APP_ENV=production
```

### 4.4 Construir Aplicaci√≥n
```bash
# Construir para producci√≥n
npm run build:aws

# Verificar que se cre√≥ la carpeta dist
ls -la dist/
```

### 4.5 Configurar Permisos
```bash
# Asignar permisos correctos
sudo chown -R apache:apache /var/www/html/wuten
sudo chmod -R 755 /var/www/html/wuten

# Verificar permisos
ls -la /var/www/html/wuten/
```

---

## üåê PASO 5: CONFIGURACI√ìN DE APACHE

### 5.1 Aplicar Configuraci√≥n Robusta
```bash
# Descargar script de configuraci√≥n
wget https://raw.githubusercontent.com/tu-usuario/react-wuten/main/apply-robust-config.sh
chmod +x apply-robust-config.sh

# Editar script para tu IP
nano apply-robust-config.sh
# Cambiar: ServerName TU_IP_ELASTICA

# Ejecutar configuraci√≥n
./apply-robust-config.sh
```

### 5.2 Verificar Configuraci√≥n
```bash
# Verificar sintaxis de Apache
sudo httpd -t

# Si hay errores, revisar configuraci√≥n
sudo nano /etc/httpd/conf.d/wuten.conf

# Reiniciar Apache
sudo systemctl restart httpd
```

### 5.3 Configurar Grupos de Seguridad AWS
```bash
# En la consola AWS EC2:
# 1. Ir a Instances > Seleccionar tu instancia
# 2. En la pesta√±a Security, hacer clic en el grupo de seguridad
# 3. Agregar reglas de entrada:
#    - Tipo: HTTP, Puerto: 80, Fuente: 0.0.0.0/0
#    - Tipo: HTTPS, Puerto: 443, Fuente: 0.0.0.0/0
#    - Tipo: MySQL/Aurora, Puerto: 3306, Fuente: 0.0.0.0/0 (solo si necesitas acceso remoto)

# Verificar configuraci√≥n local (si usas firewalld)
sudo firewall-cmd --permanent --add-service=http
sudo firewall-cmd --permanent --add-service=https
sudo firewall-cmd --reload
sudo firewall-cmd --list-services
```

---

## üîß PASO 6: CONFIGURACI√ìN DEL BACKEND

### 6.1 Configurar Conexi√≥n a Base de Datos
```bash
# Editar configuraci√≥n del backend
nano backend/config.php

# Verificar que use las variables de entorno correctas:
# $host = getenv('DB_HOST') ?: 'localhost';
# $usuario = getenv('DB_USER') ?: 'wuten_user';
# $password = getenv('DB_PASSWORD') ?: 'TuPasswordSegura123!';
# $base_datos = getenv('DB_NAME') ?: 'wuten';
```

### 6.2 Configurar Variables de Entorno del Sistema
```bash
# Crear archivo de variables de entorno
sudo nano /etc/environment

# Agregar:
DB_HOST=localhost
DB_USER=wuten_user
DB_PASSWORD=TuPasswordSegura123!
DB_NAME=wuten
APP_ENV=production

# Recargar variables
source /etc/environment
```

### 6.3 Verificar Backend
```bash
# Probar conexi√≥n a base de datos
curl http://TU_IP_ELASTICA/wuten/backend/test_connection.php

# Verificar configuraci√≥n del entorno
curl http://TU_IP_ELASTICA/wuten/backend/check_environment.php
```

---

## ‚úÖ PASO 7: VERIFICACI√ìN FINAL

### 7.1 Verificar URLs de Acceso
```bash
# URLs principales:
# - http://TU_IP_ELASTICA/ (p√°gina de prueba de Apache)
# - http://TU_IP_ELASTICA/wuten/ (aplicaci√≥n principal)
# - http://TU_IP_ELASTICA/phpMyAdmin (gesti√≥n de base de datos)

# Probar acceso
curl -I http://TU_IP_ELASTICA/
curl -I http://TU_IP_ELASTICA/wuten/

# Verificar que aparece "It works!" en la p√°gina principal de Apache
```

### 7.2 Verificar Funcionalidad
```bash
# Verificar logs de Apache
sudo tail -f /etc/httpd/logs/wuten_error.log
sudo tail -f /etc/httpd/logs/wuten_access.log

# Verificar estado de servicios
sudo systemctl status httpd
sudo systemctl status mariadb
```

### 7.3 Checklist de Verificaci√≥n
- [ ] ‚úÖ Apache ejecut√°ndose
- [ ] ‚úÖ MariaDB ejecut√°ndose
- [ ] ‚úÖ phpMyAdmin accesible
- [ ] ‚úÖ Base de datos "wuten" importada
- [ ] ‚úÖ Frontend React cargando
- [ ] ‚úÖ Backend PHP respondiendo
- [ ] ‚úÖ Conexi√≥n a base de datos funcionando
- [ ] ‚úÖ Logs sin errores cr√≠ticos

---

## üîß COMANDOS √öTILES DE MANTENIMIENTO

### Reiniciar Servicios
```bash
# Reiniciar Apache
sudo systemctl restart httpd

# Reiniciar MariaDB
sudo systemctl restart mariadb

# Recargar configuraci√≥n Apache
sudo systemctl reload httpd
```

### Actualizar Aplicaci√≥n
```bash
# Actualizar c√≥digo
cd /var/www/html/wuten
git pull origin main

# Reinstalar dependencias (si es necesario)
npm install

# Reconstruir
npm run build:aws

# Actualizar permisos
sudo chown -R apache:apache /var/www/html/wuten

# Recargar Apache
sudo systemctl reload httpd
```

### Backup de Base de Datos
```bash
# Crear backup
mysqldump -u wuten_user -p wuten > /backup/wuten_$(date +%Y%m%d_%H%M%S).sql

# Restaurar backup
mysql -u wuten_user -p wuten < /backup/wuten_20241201_120000.sql
```

---

## üö® SOLUCI√ìN DE PROBLEMAS

### No puedo conectarme al servidor web
**S√≠ntoma:** No se puede acceder a la aplicaci√≥n desde el navegador

**Soluci√≥n:**
```bash
# Verificar que Apache est√° ejecut√°ndose
sudo systemctl is-enabled httpd
sudo systemctl status httpd

# Verificar grupos de seguridad en AWS
# Ir a EC2 > Instances > Security Groups
# Asegurar que hay regla HTTP (puerto 80) permitida

# Verificar firewall local (si aplica)
sudo firewall-cmd --list-services
```

### Error: MIME type para JavaScript
**S√≠ntoma:** `Failed to load module script: Expected a JavaScript-or-Wasm module script but the server responded with a MIME type of "text/html"`

**Soluci√≥n:**
```bash
# Aplicar configuraci√≥n robusta
./apply-robust-config.sh
```

### Error: 404 en assets
**S√≠ntoma:** `GET http://TU_IP_AWS/assets/... 404 (Not Found)`

**Soluci√≥n:**
```bash
# Verificar que los archivos existen
ls -la /var/www/html/wuten/dist/assets/

# Verificar permisos
sudo chown -R apache:apache /var/www/html/wuten

# Aplicar configuraci√≥n robusta
./apply-robust-config.sh
```

### Error: Conexi√≥n a Base de Datos
**S√≠ntoma:** `Error de conexi√≥n: Access denied for user`

**Soluci√≥n:**
```bash
# Verificar credenciales
mysql -u wuten_user -p wuten

# Verificar variables de entorno
echo $DB_USER
echo $DB_PASSWORD

# Reconfigurar si es necesario
sudo nano /etc/environment
source /etc/environment
```

### Error: Apache no inicia
**S√≠ntoma:** `Failed to start httpd.service`

**Soluci√≥n:**
```bash
# Verificar configuraci√≥n
sudo httpd -t

# Ver logs detallados
sudo journalctl -u httpd -f

# Restaurar configuraci√≥n anterior si es necesario
sudo cp /etc/httpd/conf.d/wuten.conf.backup.* /etc/httpd/conf.d/wuten.conf
```

### Error: SELinux bloqueando
**S√≠ntoma:** Permisos denegados a pesar de configuraci√≥n correcta

**Soluci√≥n:**
```bash
# Deshabilitar SELinux temporalmente
sudo setenforce 0

# O configurar SELinux correctamente
sudo setsebool -P httpd_can_network_connect 1
sudo setsebool -P httpd_unified 1
```

---

## üîí CONFIGURACI√ìN DE SEGURIDAD

### Configurar SSL (Opcional)
```bash
# Instalar Certbot
sudo yum install -y certbot python3-certbot-apache

# Obtener certificado (si tienes dominio)
sudo certbot --apache -d tu-dominio.com

# Configurar renovaci√≥n autom√°tica
sudo crontab -e
# Agregar: 0 12 * * * /usr/bin/certbot renew --quiet
```

### Configurar Backups Autom√°ticos
```bash
# Crear script de backup
sudo nano /usr/local/bin/backup-wuten.sh

# Contenido del script:
#!/bin/bash
BACKUP_DIR="/backup"
DATE=$(date +%Y%m%d_%H%M%S)
mysqldump -u wuten_user -p'TuPasswordSegura123!' wuten > $BACKUP_DIR/wuten_$DATE.sql
find $BACKUP_DIR -name "*.sql" -mtime +7 -delete

# Hacer ejecutable
sudo chmod +x /usr/local/bin/backup-wuten.sh

# Configurar cron job
sudo crontab -e
# Agregar: 0 2 * * * /usr/local/bin/backup-wuten.sh
```

---

## üìä MONITOREO Y LOGS

### Logs Importantes
```bash
# Logs de error de la aplicaci√≥n
sudo tail -f /etc/httpd/logs/wuten_error.log

# Logs de acceso
sudo tail -f /etc/httpd/logs/wuten_access.log

# Logs del sistema
sudo journalctl -u httpd -f
sudo journalctl -u mariadb -f
```

### M√©tricas B√°sicas
```bash
# Uso de memoria
free -h

# Uso de disco
df -h

# Procesos de Apache
ps aux | grep httpd

# Conexiones activas
sudo netstat -tulpn | grep :80
```

---

## üìû INFORMACI√ìN DE CONTACTO Y SOPORTE

### Informaci√≥n del Sistema
```bash
# Versi√≥n de Node.js
node --version

# Versi√≥n de npm
npm --version

# Versi√≥n de Apache
httpd -v

# Versi√≥n de MariaDB
mysql --version

# Sistema operativo
cat /etc/os-release
```

### Archivos de Configuraci√≥n Importantes
- **Apache:** `/etc/httpd/conf.d/wuten.conf`
- **MariaDB:** `/etc/my.cnf`
- **PHP:** `/etc/php.ini`
- **Aplicaci√≥n:** `/var/www/html/wuten/`
- **Logs:** `/etc/httpd/logs/wuten_*.log`
- **Backup:** `/etc/httpd/conf.d/wuten.conf.backup.*`

---

## üéØ CHECKLIST FINAL DE VERIFICACI√ìN

- [ ] ‚úÖ Instancia AWS Linux 2023 creada
- [ ] ‚úÖ IP El√°stica configurada
- [ ] ‚úÖ LAMP Stack instalado (Apache, MariaDB, PHP)
- [ ] ‚úÖ phpMyAdmin instalado y configurado
- [ ] ‚úÖ Base de datos "wuten" creada e importada
- [ ] ‚úÖ Usuario de base de datos configurado
- [ ] ‚úÖ Node.js instalado
- [ ] ‚úÖ Repositorio clonado correctamente
- [ ] ‚úÖ Dependencias instaladas (`npm install`)
- [ ] ‚úÖ Variables de entorno configuradas
- [ ] ‚úÖ Proyecto construido (`npm run build:aws`)
- [ ] ‚úÖ Permisos configurados (apache:apache)
- [ ] ‚úÖ Configuraci√≥n Apache aplicada
- [ ] ‚úÖ Firewall configurado
- [ ] ‚úÖ Apache ejecut√°ndose (`systemctl status httpd`)
- [ ] ‚úÖ MariaDB ejecut√°ndose (`systemctl status mariadb`)
- [ ] ‚úÖ Aplicaci√≥n accesible en todas las URLs
- [ ] ‚úÖ phpMyAdmin accesible
- [ ] ‚úÖ Assets cargando correctamente
- [ ] ‚úÖ Backend respondiendo
- [ ] ‚úÖ Conexi√≥n a base de datos funcionando
- [ ] ‚úÖ Logs funcionando sin errores cr√≠ticos
- [ ] ‚úÖ Backup de configuraci√≥n creado

---

## üìö RECURSOS ADICIONALES

- [Tutorial oficial AWS LAMP en AL2023](https://docs.aws.amazon.com/es_es/linux/al2023/ug/ec2-lamp-amazon-linux-2023.html)
- [Documentaci√≥n de Apache](https://httpd.apache.org/docs/)
- [Gu√≠a de AWS Linux 2023](https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/amazon-linux-2023-user-guide.html)
- [Documentaci√≥n de MariaDB](https://mariadb.com/kb/en/documentation/)
- [Documentaci√≥n de phpMyAdmin](https://docs.phpmyadmin.net/)
- [Documentaci√≥n de Vite](https://vitejs.dev/guide/)
- [Documentaci√≥n de React](https://react.dev/)

---

**üéâ ¬°Felicidades! Tu aplicaci√≥n Wuten Inmobiliaria est√° ahora desplegada en AWS Linux 2023 con MariaDB y phpMyAdmin.**

## üìã RESUMEN DEL PROCESO

1. **‚úÖ LAMP Stack:** Instalado manualmente siguiendo la documentaci√≥n oficial de AWS
2. **‚úÖ Base de Datos:** Configurada y migrada desde tu servidor actual
3. **‚úÖ phpMyAdmin:** Instalado y configurado para gesti√≥n de base de datos
4. **‚úÖ Aplicaci√≥n:** Desplegada y funcionando correctamente

## üîÑ PR√ìXIMOS PASOS RECOMENDADOS

- **Configurar SSL/TLS** para mayor seguridad
- **Configurar backups autom√°ticos** de la base de datos
- **Monitorear logs** y rendimiento de la aplicaci√≥n
- **Configurar alertas** para disponibilidad del servicio

**Nota:** Esta gu√≠a est√° basada en el [tutorial oficial de AWS para LAMP en Amazon Linux 2023](https://docs.aws.amazon.com/es_es/linux/al2023/ug/ec2-lamp-amazon-linux-2023.html) y optimizada para esta distribuci√≥n espec√≠fica. Para otras distribuciones, algunos comandos pueden variar. 